@page "/contact"

@inject MessageService MessageService
@inject IContactService ContactService
@inject NavigationManager Nav
@inject UiState UiState

<PageTitle>Kontaktujte nás</PageTitle>

<div class="container py-4">
    <div class="row justify-content-center">
        <div class="col-12 col-md-10 col-lg-7 col-xl-6">
            <div class="card shadow-sm">
                <div class="card-body p-4">
                    <h3 class="mb-2">Kontaktujte nás</h3>
                    <p class="text-muted mb-4">
                        Napište nám zprávu. Odpověď vám přijde na zadaný e-mail.
                    </p>

                    <EditForm Model="@model" OnValidSubmit="SendAsync">
                        <DataAnnotationsValidator />
                        <ValidationSummary class="text-danger mb-3" />

                        <div class="mb-3">
                            <label class="form-label">E-mail pro odpověď</label>
                            <InputText class="form-control" @bind-Value="model.ReplyEmail" placeholder="např. jan.novak@email.cz" />
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Předmět</label>
                            <InputText class="form-control" @bind-Value="model.Subject" placeholder="např. Dotaz k objednávce" />
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Zpráva</label>
                            <InputTextArea class="form-control" rows="6" @bind-Value="model.Message" placeholder="Napište prosím co nejvíce detailů..." />
                        </div>

                        <div class="d-flex gap-2">
                            <button class="btn btn-primary" type="submit" disabled="@isSubmitting">
                                Odeslat
                            </button>
                        </div>
                    </EditForm>
                </div>
            </div>

            <div class="small text-muted mt-3">
                Tip: Pokud řešíte konkrétní objednávku, uveďte prosím její ID do zprávy.
            </div>
        </div>
    </div>
</div>

@code {
    private readonly ContactModel model = new();
    private bool isSubmitting;

    private async Task SendAsync()
    {
        if (isSubmitting)
            return;

        isSubmitting = true;
        UiState.StartBusy("Odesílám zprávu...");

        try
        {
            await ContactService.SendMessageToSupportAsync(model);
            MessageService.ShowSuccess("Zpráva byla odeslána. Ozveme se co nejdříve.");
            Nav.NavigateTo("/");
        }
        catch (Exception ex)
        {
            MessageService.ShowError(ex.Message);
        }
        finally
        {
            UiState.StopBusy();
            isSubmitting = false;
        }
    }
}
