
<div class="d-flex align-items-center gap-2">
    <div class="input-group input-group-sm" style="width: 140px;">
        <button class="btn btn-outline-secondary"
            type="button"
            disabled="@(Disabled || Qty <= 1)"
            @onclick="Decrease">
        -
        </button>

        <input class="form-control text-center" value="@Qty" readonly/>

        <button class="btn btn-outline-secondary"
                type="button"
                disabled="@(Disabled || Qty >= Max)"
                @onclick="Increase">
            +
        </button>
    </div>

    <button class="btn btn-warning btn-sm"
            disabled="@(Disabled || Max <= 0 || isBusy)"
            @onclick="AddClickedAsync">
        Přidat
    </button>
</div>



@code {
    [Parameter] public int Max { get; set; }
    [Parameter] public bool Disabled { get; set; }
    [Parameter] public EventCallback<int> OnAdd { get; set; }
    [Parameter] public string? CssClass { get; set; }

    private bool isBusy;
    private int Qty { get; set; } = 1;

    protected override void OnParametersSet()
    {
        if (Max <= 0) Qty = 1;
        else if (Qty > Max) Qty = Max;
        else if (Qty < 1) Qty = 1;
    }

    private void Decrease()
    {
        if (Qty > 1)
        {
            Qty--;
            StateHasChanged();
        }
    }

    private void Increase()
    {
        if (Qty < Max)
        {
            Qty++;
            StateHasChanged();
        }
    }

    private async Task AddClickedAsync()
    {
        if(isBusy)
            return;

        isBusy = true;

        try
        {
            await OnAdd.InvokeAsync(Qty);
            Qty = 1;
        }
        finally
        {
            isBusy = false;
        }
    }
}
